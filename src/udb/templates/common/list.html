{% extends 'layout.html' %}
{% import "macro.html" as macro %}
{% import "components/table.html" as _table with context %}
{% block title %}
{{ macro.display_name(model_name)}}
{% endblock %}
{% block body %}
  <div class="row">
    <div class="col">
      <h4 id="title">
        {{ macro.icon(model_name)}} {% trans %}List of{% endtrans %} {{ macro.display_name(model_name)}}
      </h2>
    </div>
    <div class="col text-end mb-2">
      {% if has_new %}
        {% set new_disabled = not currentuser.allow_new_record() %}
        <a class="btn btn-primary {% if new_disabled %}disabled{% endif %}"
           href="{{ url_for(model, 'new')}}"
           role="button"
           {% if new_disabled %}aria-disabled="true"{% endif %}>{% trans %}Create{% endtrans %}
        {{ macro.display_name(model_name)}}</a>
      {% endif %}
    </div>
  </div>
  {# Define a default columns list from form #}
  {% set ns = namespace(default_columns=[]) %}
  {% set table_default_buttons = [] %}
  {% for field in form %}
    {% if field.widget['input_type'] != 'hidden' %}
      {% set ns.default_columns = ns.default_columns + [{'name': field.name, 'data': field.name, 'title': field.label.text, 'orderable':True, 'render': 'summary' if loop.first else 'text'}] %}
    {% endif %}
  {% endfor %}
  {% set table_columns = columns|d(ns.default_columns) %}
  {# Status column and filter #}
  {% if has_status %}
    {% set table_columns = table_columns + [{'name': 'status', 'data': 'status', 'visible': false, 'search': 'enabled'}] %}
    {% set table_default_buttons = table_default_buttons + [{'text': _('Hide Deleted'), 'extend': 'filter', 'column': 'status:name', 'search': 'enabled'}] %}
  {% endif %}
  {# Default filters #}
  {% if 'owner' in (table_columns|map(attribute='name')|list) %}
    {% set table_default_buttons = table_default_buttons + [{'text': _('Owned by me'), 'extend': 'filter', 'column': 'owner:name', 'search': currentuser.summary}] %}
  {% endif %}
  {% set table_default_buttons = table_default_buttons + [{'text': _('Clear'), 'extend': 'clear'}] %}
  {# Show default table #}
  {{ _table.table(data="data.json", paging=True, pageLength=100, columns=table_columns, buttons=table_extra_buttons|d([]) + table_default_buttons)}}
{% endblock body %}
{% block script %}
  <script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })
  </script>
{% endblock %}
