{% import "macro.html" as macro %}
{% set table_count = 1 %}
{% macro table(obj_list, table_extra_columns=[], empty_message=_('List is empty'), filter_location_id=None) %}
{% set id = 'table' + table_count|string %}
<table id="{{id}}" class="table table-hover"
    aria-label="{% if obj_list and obj_list|list|length > 0 %}{{macro.display_name(obj_list|first)}}{% else %}{{empty_message}}{% endif %}">
    <thead>
        <tr>
            {% for name, label, sortable in table_extra_columns %}
            <th scope="col" data-orderable="{{'true' if sortable else 'false'}}">
                {{ label }}
            </th>
            {% endfor %}
            <th scope="col" style="width: 100px" data-orderable="false">
                <span class="visually-hidden">{%trans%}Actions{%endtrans%}</span>
            </th>
        </tr>
    </thead>
    <tbody>
        {% for obj in obj_list %}
        <tr>
            {{ caller(obj) }}
            <td class="align-middle">
                <a class="btn btn-primary btn-circle btn-hover" href="{{url_for(obj, 'edit')}}" data-bs-toggle="tooltip"
                    data-bs-placement="top" title="{% trans %}View more detail{% endtrans %}">
                    <i class="bi bi-chevron-right" aria-hidden="true"></i>
                    <span class="visually-hidden">{%trans%}Edit{%endtrans%}</span>
                </a>
            </td>
        </tr>
        {% endfor %}

    </tbody>
</table>
<script>
    {% set search_enabled = 'true' if filter_location_id else 'false' %}
    $(document).ready(function () {
        $('#{{id}}').DataTable({
            dom: "f" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-12'i>>",
            language: {
                "aria": {
                    "sortAscending": ": {%trans%}activate to sort column ascending{%endtrans%}",
                    "sortDescending": ": {%trans%}activate to sort column descending{%endtrans%}"
                },
                "info": "{%trans%}Showing _START_ of _TOTAL_ entries{%endtrans%}",
                "infoFiltered": "{%trans%}(filtered from _MAX_ total entries){%endtrans%}",
                "infoEmpty": "{%trans%}Showing 0 of 0 entries{%endtrans%}",
                "search": "{%trans%}Filter: {%endtrans%}",
                "zeroRecords": "{{ empty_message }}",
            },
            initComplete: function () {
                {%- if filter_location_id %}
                $("#{{id}}_filter input").detach().appendTo('{{filter_location_id}}');
                $("#{{id}}_filter").detach();
                {%- endif %}
            },
            paging: false,
            searching: {{search_enabled}},
            stateSave: true,
            drawCallback: function (settings) {
                var table = this;
                var api = this.api();
                var rows = api.rows({ page: 'current' }).nodes();
                var last = null;
                var order = api.order();
                if(order) {
                    // Adjust depth according to data-depth attributes
                    api
                        .column(order[0], { page: 'current' })
                        .nodes()
                        .to$()
                        .each(function (node) {
                            var depth = $(this).attr('data-depth');
                            if(depth){
                                $(this).parent().addClass('depth-' + depth);
                            } else {
                                for(var i=0; i<=4; i++) {
                                    $(this).parent().removeClass('depth-' + i);
                                }
                            }
                        });
                }
            }
        });
    });
</script>
{% endmacro %}